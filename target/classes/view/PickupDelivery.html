<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Pickup & Delivery</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 2rem;
    }

   #map {
  height: 80vh; /* ocupa 80% de la altura de la ventana */
  width: 90%;   /* casi todo el ancho */
  margin: 1rem auto;
  border: 2px solid #ccc;
  border-radius: 8px;
}

  </style>
</head>
<body>
  <h2>Bonjour, voici la page Pickup & Delivery</h2>
  <div id="map"></div>
  <script>
    // --- Initialisation de la carte ---
    const map = L.map('map', {
      center: [45.7578137, 4.8320114], // Lyon
      zoom: 15,
    });

    // --- Couche OpenStreetMap ---
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution:
        '&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer">OpenStreetMap</a> contributors',
    }).addTo(map);

    // --- Fetch depuis le backend ---
    fetch("/api/carte")
      .then(res => res.json())
      .then(data => {
        // Ajouter les noeuds
        data.noeuds.forEach(n => {
          L.marker([n.lat, n.lng]).addTo(map).bindPopup("Noeud " + n.id);
        });

        // Ajouter les troncons
        data.troncons.forEach(t => {
          const from = data.noeuds.find(n => n.id === t.from);
          const to = data.noeuds.find(n => n.id === t.to);
          if (from && to) {
            L.polyline([[from.lat, from.lng], [to.lat, to.lng]], { color: 'blue' }).addTo(map);
          }
        });

        // Adapter la vue Ã  la taille de tous les noeuds
        const bounds = L.latLngBounds(data.noeuds.map(n => [n.lat, n.lng]));
        map.fitBounds(bounds);
      })
      .catch(err => console.error(err));
  </script>
</body>
</html>
